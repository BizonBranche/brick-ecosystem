<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß± BRICK - Referral Program</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß±</text></svg>">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #fff5f5 0%, #fff 100%);
            min-height: 100vh;
            color: #1e293b;
            padding: 20px;
        }

        /* ===== STICKY MENU (harmonis√©) ===== */
        .nav {
            background: white;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #FF44AA20;
            padding: 12px 24px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(255,68,170,0.1);
            margin-bottom: 30px;
            border-radius: 60px;
        }

        .nav-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .brand a {
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .nav-links {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-links a {
            color: #64748b;
            text-decoration: none;
            font-weight: 600;
            font-size: 15px;
            padding: 8px 16px;
            border-radius: 40px;
            transition: all 0.2s;
            background: transparent;
        }

        .nav-links a:hover {
            color: #FF44AA;
            background: #fff0f5;
        }

        .nav-links a.active {
            color: #FF44AA;
            background: #fff0f5;
            border: 1px solid #FF44AA20;
        }

        .spacer {
            flex: 1;
        }

        .wallet-badge {
            background: #fff0f5;
            border: 1px solid #FF44AA;
            padding: 6px 16px;
            border-radius: 40px;
            font-size: 13px;
            font-weight: 600;
            color: #FF44AA;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #whoamiNav {
            font-weight: 600;
            font-size: 13px;
        }

        .btn-connect {
            background: #FF44AA;
            border: none;
            padding: 8px 20px;
            border-radius: 40px;
            color: white;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
            box-shadow: 0 4px 10px rgba(255,68,170,0.3);
        }

        .btn-connect:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255,68,170,0.4);
        }

        /* ===== LOGO DU MENU ===== */
        .juicy-cube-mini {
            width: 45px;
            height: 45px;
            position: relative;
            transform-style: preserve-3d;
            animation: spinSlow 10s infinite linear;
            margin-right: 8px;
        }

        .cube-face-mini {
            position: absolute;
            width: 15px;
            height: 15px;
            border: 2px solid white;
            border-radius: 4px;
            box-shadow: 0 0 15px currentColor;
        }

        .cube-face-mini:nth-child(1) {
            background: #ff44aa;
            transform: rotateY(0deg) translateZ(22px);
            box-shadow: 0 0 15px #ff44aa;
        }
        .cube-face-mini:nth-child(2) {
            background: #b87cff;
            transform: rotateY(90deg) translateZ(22px);
            box-shadow: 0 0 15px #b87cff;
        }
        .cube-face-mini:nth-child(3) {
            background: #8b5cf6;
            transform: rotateX(90deg) translateZ(22px);
            box-shadow: 0 0 15px #8b5cf6;
        }

        .brand-text {
            font-weight: 900;
            font-size: 28px;
            background: linear-gradient(135deg, #ff44aa, #b87cff, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 10px #ff44aa) drop-shadow(0 0 20px #b87cff);
            animation: haloSoft 3s infinite ease-in-out;
            letter-spacing: -0.5px;
        }

        @keyframes spinSlow {
            0% { transform: rotateX(0deg) rotateY(0deg); }
            100% { transform: rotateX(360deg) rotateY(360deg); }
        }

        @keyframes haloSoft {
            0% { filter: drop-shadow(0 0 10px #ff44aa) drop-shadow(0 0 20px #b87cff); }
            50% { filter: drop-shadow(0 0 20px #ff44aa) drop-shadow(0 0 40px #b87cff) drop-shadow(0 0 60px #8b5cf6); }
            100% { filter: drop-shadow(0 0 10px #ff44aa) drop-shadow(0 0 20px #b87cff); }
        }

        /* ===== HEADER AVEC LOGO JUICY ===== */
        .header {
            text-align: center;
            padding: 20px 0 20px;
        }

        .logo-title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .header-juicy-cube {
            width: 80px;
            height: 80px;
            position: relative;
            transform-style: preserve-3d;
            animation: spinHeader 12s infinite linear;
            filter: drop-shadow(0 0 30px rgba(255,68,170,0.8));
        }

        .header-cube-face {
            position: absolute;
            width: 26px;
            height: 26px;
            border: 3px solid rgba(255,255,255,0.9);
            border-radius: 8px;
            box-shadow: 0 0 25px currentColor, inset 0 0 15px rgba(255,255,255,0.8);
            background: linear-gradient(145deg, #ff44aa, #ff69b4);
        }

        .header-cube-face:nth-child(1) {
            background: #ff44aa;
            transform: rotateY(0deg) translateZ(40px);
            box-shadow: 0 0 30px #ff44aa;
        }
        .header-cube-face:nth-child(2) {
            background: #b87cff;
            transform: rotateY(90deg) translateZ(40px);
            box-shadow: 0 0 30px #b87cff;
        }
        .header-cube-face:nth-child(3) {
            background: #8b5cf6;
            transform: rotateY(180deg) translateZ(40px);
            box-shadow: 0 0 30px #8b5cf6;
        }
        .header-cube-face:nth-child(4) {
            background: #00ffff;
            transform: rotateY(-90deg) translateZ(40px);
            box-shadow: 0 0 30px #00ffff;
        }
        .header-cube-face:nth-child(5) {
            background: #ff1493;
            transform: rotateX(90deg) translateZ(40px);
            box-shadow: 0 0 30px #ff1493;
        }
        .header-cube-face:nth-child(6) {
            background: #ff8844;
            transform: rotateX(-90deg) translateZ(40px);
            box-shadow: 0 0 30px #ff8844;
        }

        .header-cubelet {
            position: absolute;
            width: 22px;
            height: 22px;
            background: linear-gradient(135deg, #ff44aa, #b87cff, #00ffff);
            border: 2px solid white;
            border-radius: 6px;
            box-shadow: 0 0 20px currentColor;
            animation: cubeletFloat 3s infinite alternate;
        }

        .header-cubelet:nth-child(7) { transform: translate3d(25px, 12px, 25px); }
        .header-cubelet:nth-child(8) { transform: translate3d(40px, 40px, 12px); }
        .header-cubelet:nth-child(9) { transform: translate3d(12px, 50px, 40px); }
        .header-cubelet:nth-child(10) { transform: translate3d(50px, 25px, 25px); }

        @keyframes spinHeader {
            0% { transform: rotateX(0deg) rotateY(0deg); }
            100% { transform: rotateX(360deg) rotateY(360deg); }
        }

        @keyframes cubeletFloat {
            0% { transform: translate3d(25px, 12px, 25px) scale(1); opacity: 0.8; }
            100% { transform: translate3d(28px, 15px, 28px) scale(1.2); opacity: 1; }
        }

        .gradient-title {
            font-size: 56px;
            background: linear-gradient(135deg, #f97316, #FF44AA, #b87cff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            letter-spacing: -1px;
            margin: 0;
            animation: titlePulse 3s infinite ease-in-out;
            filter: drop-shadow(0 0 20px #f97316);
        }

        @keyframes titlePulse {
            0%, 100% { filter: drop-shadow(0 0 10px #f97316); }
            50% { filter: drop-shadow(0 0 30px #f97316) drop-shadow(0 0 60px #FF44AA); }
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-header p {
            font-size: 18px;
            color: #64748b;
            max-width: 600px;
            margin: 0 auto;
        }

        /* ===== MAIN GRID ===== */
        .wrap {
            max-width: 1400px;
            margin: 0 auto;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 24px;
        }

        @media (max-width: 1000px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        /* ===== CARDS ===== */
        .card {
            background: white;
            border-radius: 32px;
            padding: 28px;
            margin-bottom: 24px;
            border: 2px solid #FF44AA20;
            box-shadow: 0 10px 30px rgba(255,68,170,0.1);
            transition: all 0.3s;
        }

        .card:hover {
            border-color: #FF44AA;
            box-shadow: 0 20px 40px rgba(255,68,170,0.15);
        }

        .card-glow {
            border: 2px solid #FF44AA;
            box-shadow: 0 10px 30px rgba(255,68,170,0.2);
        }

        .title {
            font-size: 28px;
            font-weight: 800;
            color: #FF44AA;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .title-sm {
            font-size: 22px;
            margin-bottom: 16px;
        }

        /* ===== TOOLS GRID ===== */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 800px) {
            .tools-grid {
                grid-template-columns: 1fr;
            }
        }

        .tool-card {
            background: #f8fafc;
            border: 2px solid #FF44AA20;
            border-radius: 24px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .tool-card:hover {
            border-color: #FF44AA;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255,68,170,0.15);
        }

        .promo-link {
            display: block;
            position: relative;
            cursor: pointer;
            text-decoration: none;
            margin-bottom: 15px;
        }

        .promo-link:hover img {
            transform: scale(1.02);
            transition: transform 0.2s;
            box-shadow: 0 10px 30px rgba(255,68,170,0.3);
        }

        .tool-card img {
            width: 100%;
            border-radius: 16px;
            border: 2px solid #FF44AA20;
        }

        .tool-card h3 {
            color: #FF44AA;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .tool-card p {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .download-section {
            margin-top: 15px;
        }

        .btn-download {
            background: white;
            border: 2px solid #FF44AA;
            border-radius: 60px;
            padding: 12px 20px;
            color: #FF44AA;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }

        .btn-download:hover {
            background: #FF44AA;
            color: white;
            transform: scale(1.02);
        }

        .btn-download:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== WALLET SECTION ===== */
        .connect-section {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .wallet-info {
            display: flex;
            align-items: center;
            gap: 16px;
            background: #fff0f5;
            padding: 16px 20px;
            border-radius: 24px;
            border: 1px solid #FF44AA;
        }

        .wallet-avatar {
            width: 48px;
            height: 48px;
            background: #FF44AA;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 24px;
            color: white;
        }

        .wallet-address {
            font-family: monospace;
            font-size: 16px;
            color: #FF44AA;
            font-weight: 600;
        }

        .ref-link-box {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .ref-link-box input {
            flex: 1;
            background: #f8fafc;
            border: 2px solid #FF44AA20;
            border-radius: 60px;
            padding: 14px 20px;
            color: #1e293b;
            font-family: monospace;
            font-size: 14px;
        }

        .ref-link-box input:focus {
            outline: none;
            border-color: #FF44AA;
        }

        .btn-copy {
            background: #fff0f5;
            border: 2px solid #FF44AA;
            border-radius: 60px;
            padding: 0 24px;
            color: #FF44AA;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-copy:hover {
            background: #FF44AA;
            color: white;
        }

        /* ===== RULES SECTION ===== */
        .rules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }

        .rule-item {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            background: #f8fafc;
            padding: 16px;
            border-radius: 16px;
            border: 1px solid #FF44AA20;
        }

        .rule-check {
            color: #00aa88;
            font-size: 20px;
        }

        .rule-cross {
            color: #ff4466;
            font-size: 20px;
        }

        .rule-text {
            flex: 1;
        }

        .rule-title {
            font-weight: 700;
            color: #FF44AA;
        }

        .rule-desc {
            font-size: 13px;
            color: #64748b;
        }

        /* ===== FAQ ===== */
        .faq-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #FF44AA20;
        }

        .faq-item:last-child {
            border-bottom: none;
        }

        .faq-question {
            font-weight: 700;
            color: #FF44AA;
            margin-bottom: 6px;
            font-size: 16px;
        }

        .faq-answer {
            color: #64748b;
            font-size: 14px;
            line-height: 1.6;
        }

        /* ===== NOUVEAU : DASHBOARD DOUBLE ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin: 40px 0;
        }

        @media (max-width: 1000px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .dashboard-canvas {
            background: white;
            border-radius: 32px;
            padding: 28px;
            border: 2px solid #FF44AA20;
            box-shadow: 0 10px 30px rgba(255,68,170,0.1);
        }

        .dashboard-canvas h2 {
            color: #FF44AA;
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dashboard-plaza {
            background: white;
            border-radius: 32px;
            padding: 28px;
            border: 2px solid #00aa8820;
            box-shadow: 0 10px 30px rgba(0,170,136,0.1);
        }

        .dashboard-plaza h2 {
            color: #00aa88;
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: #f8fafc;
            border-radius: 20px;
            padding: 20px;
        }

        .kpi-label {
            font-size: 14px;
            color: #64748b;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 800;
            line-height: 1;
        }

        .canvas-value {
            color: #FF44AA;
        }

        .plaza-value {
            color: #00aa88;
        }

        .kpi-unit {
            font-size: 14px;
            color: #64748b;
            margin-left: 4px;
        }

        .activity-list {
            background: #f8fafc;
            border-radius: 20px;
            padding: 16px;
            margin-top: 20px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .canvas-icon {
            background: #fff0f5;
            color: #FF44AA;
        }

        .plaza-icon {
            background: #e0fff5;
            color: #00aa88;
        }

        .activity-detail {
            flex: 1;
            font-size: 14px;
        }

        .activity-detail span {
            font-weight: 600;
        }

        .canvas-address {
            color: #FF44AA;
        }

        .plaza-address {
            color: #00aa88;
        }

        .activity-time {
            font-size: 12px;
            color: #94a3b8;
        }

        /* ===== FOOTER ===== */
        footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 2px solid #FF44AA20;
        }
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
            max-width: 1300px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .footer-links a {
            color: #64748b;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: color 0.2s;
        }
        .footer-links a:hover {
            color: #FF44AA;
        }
        .footer-copyright {
            text-align: center;
            margin: 30px 0 20px;
            color: #94a3b8;
            font-size: 14px;
        }

        .text-center { text-align: center; }
        .mt-4 { margin-top: 16px; }
        .mb-2 { margin-bottom: 8px; }

        @media (max-width: 800px) {
            .nav-inner {
                flex-wrap: wrap;
                gap: 12px;
            }
            .nav-links {
                order: 3;
                width: 100%;
                justify-content: center;
            }
            .logo-title-container {
                flex-direction: column;
            }
            .gradient-title {
                font-size: 42px;
            }
            .grid, .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<!-- ===== STICKY MENU AVEC LOGO JUICY ===== -->
<div class="nav">
    <div class="nav-inner">
        <div class="brand">
            <a href="index.html" style="display: flex; align-items: center; text-decoration: none; gap: 8px;">
                <div class="juicy-cube-mini">
                    <div class="cube-face-mini"></div>
                    <div class="cube-face-mini"></div>
                    <div class="cube-face-mini"></div>
                </div>
                <span class="brand-text">$BRICK</span>
            </a>
        </div>
        
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="canvas.html">Canvas</a>
            <a href="plaza.html">Plaza</a>
            <a href="eternal-moments.html">Eternal</a>
            <a href="how-it-works.html">How it works</a>
            <a href="referrals.html" class="active">Referrals</a>
            <a href="daily.html">Daily</a>
        </div>
        
        <div class="spacer"></div>
        
        <div class="wallet-badge">
            <span>üîå</span>
            <span id="whoamiNav">Not connected</span>
        </div>
        
        <button class="btn-connect" onclick="connectWallet()" data-connect-wallet>
            Connect Wallet
        </button>
    </div>
</div>

<!-- ===== MAIN CONTENT ===== -->
<div class="wrap">
    
    <!-- Header avec gros logo juicy -->
    <div class="header">
        <div class="logo-title-container">
            <div class="header-juicy-cube">
                <div class="header-cube-face"></div>
                <div class="header-cube-face"></div>
                <div class="header-cube-face"></div>
                <div class="header-cube-face"></div>
                <div class="header-cube-face"></div>
                <div class="header-cube-face"></div>
                <div class="header-cubelet"></div>
                <div class="header-cubelet"></div>
                <div class="header-cubelet"></div>
                <div class="header-cubelet"></div>
            </div>
            <h1 class="gradient-title">REFERRAL PROGRAM</h1>
        </div>
        
        <div class="page-header">
            <p>
                Invite friends, earn commissions in $BRICK or USDC. Simple, transparent, automatic.
            </p>
        </div>
    </div>

    <!-- Main Grid (inchang√©) -->
    <div class="grid">
        
        <!-- LEFT COLUMN -->
        <div class="col-left">
            
            <!-- Connect Wallet Card -->
            <div class="card card-glow">
                <h2 class="title title-sm">1. Connect your wallet</h2>
                
                <div class="connect-section">
                    <div class="wallet-info" id="walletInfo" style="display: none;">
                        <div class="wallet-avatar" id="walletAvatar">üß±</div>
                        <div>
                            <div style="font-size: 12px; color: #64748b;">Connected wallet</div>
                            <div class="wallet-address" id="walletAddress">...</div>
                        </div>
                    </div>
                    
                    <div id="connectPrompt">
                        <p style="color: #64748b; margin-bottom: 16px;">
                            Connect your Solana wallet to generate your unique referral link.
                        </p>
                        <button class="btn-connect" onclick="connectWallet()" style="width: 100%;">
                            üîå Connect Wallet
                        </button>
                    </div>
                </div>
            </div>

            <!-- Referral Link Card -->
            <div class="card" id="referralCard" style="display: none;">
                <h2 class="title title-sm">2. Your unique link</h2>
                
                <div class="ref-link-box">
                    <input type="text" id="refLink" readonly value="Connect your wallet to generate your link" />
                    <button class="btn-copy" onclick="copyRefLink()" id="copyRefBtn">Copy</button>
                </div>
                
                <p style="color: #64748b; font-size: 14px; margin-top: 12px;">
                    üîó Share this link on Twitter, Telegram, Discord... Every click counts!
                </p>
            </div>

            <!-- ===== PROMO TOOLS AVEC IMAGES CLIQUABLES ===== -->
            <div class="card">
                <h2 class="title title-sm">3. Promo tools with your code</h2>
                <p style="color: #64748b; margin-bottom: 16px;">
                    Connect wallet ‚Üí Your code appears on images ‚Üí Click image to share link:
                </p>

                <div class="tools-grid">
                    
                    <!-- Carte 1 - Eternal Moments -->
                    <div class="tool-card">
                        <a href="https://www.brick-eternal.live/brick" target="_blank" class="promo-link" id="link1">
                            <img src="images/promos/etrnalmomentspromo.png" alt="Eternal Moments" id="promo1-img">
                        </a>
                        <h3>‚ú® Eternal Moments</h3>
                        <p>Capture precious moments forever</p>
                        <div class="download-section">
                            <button class="btn-download" onclick="downloadWithCode('eternal')" id="dlEternal">
                                ‚¨áÔ∏è Download with my code
                            </button>
                        </div>
                    </div>
                    
                    <!-- Carte 2 - Canvas Cells -->
                    <div class="tool-card">
                        <a href="https://www.brick-eternal.live/brick" target="_blank" class="promo-link" id="link2">
                            <img src="images/promos/canvascellspromo.png" alt="Canvas Cells" id="promo2-img">
                        </a>
                        <h3>üé® Canvas Cells</h3>
                        <p>Own a piece of digital history</p>
                        <div class="download-section">
                            <button class="btn-download" onclick="downloadWithCode('canvas')" id="dlCanvas">
                                ‚¨áÔ∏è Download with my code
                            </button>
                        </div>
                    </div>
                    
                    <!-- Carte 3 - Daily Rewards -->
                    <div class="tool-card">
                        <a href="https://www.brick-eternal.live/brick" target="_blank" class="promo-link" id="link3">
                            <img src="images/promos/dailyrewardspromo.png" alt="Daily Rewards" id="promo3-img">
                        </a>
                        <h3>üìÖ Daily Rewards</h3>
                        <p>Earn $BRICK every day</p>
                        <div class="download-section">
                            <button class="btn-download" onclick="downloadWithCode('daily')" id="dlDaily">
                                ‚¨áÔ∏è Download with my code
                            </button>
                        </div>
                    </div>
                    
                </div>
                
                <p style="color: #64748b; font-size: 13px; text-align: center; margin-top: 12px;">
                    ‚ö° Click on any image to share your referral link directly!
                </p>
            </div>

            <!-- Rules Card -->
            <div class="card">
                <h2 class="title title-sm">üìú Program Rules</h2>
                
                <div class="rules-grid">
                    <div class="rule-item">
                        <span class="rule-check">‚úÖ</span>
                        <div class="rule-text">
                            <div class="rule-title">15% on creations</div>
                            <div class="rule-desc">Commission on token creation fees</div>
                        </div>
                    </div>
                    
                    <div class="rule-item">
                        <span class="rule-check">‚úÖ</span>
                        <div class="rule-text">
                            <div class="rule-title">10% on liquidity</div>
                            <div class="rule-desc">Commission on liquidity addition fees</div>
                        </div>
                    </div>
                    
                    <div class="rule-item">
                        <span class="rule-check">‚úÖ</span>
                        <div class="rule-text">
                            <div class="rule-title">Choice of payment</div>
                            <div class="rule-desc">$BRICK or USDC, your choice</div>
                        </div>
                    </div>
                    
                    <div class="rule-item">
                        <span class="rule-check">‚úÖ</span>
                        <div class="rule-text">
                            <div class="rule-title">$25 threshold</div>
                            <div class="rule-desc">Automatic weekly payments</div>
                        </div>
                    </div>
                    
                    <div class="rule-item">
                        <span class="rule-cross">‚ùå</span>
                        <div class="rule-text">
                            <div class="rule-title">No self-referrals</div>
                            <div class="rule-desc">Automatic fraud detection</div>
                        </div>
                    </div>
                    
                    <div class="rule-item">
                        <span class="rule-check">‚úÖ</span>
                        <div class="rule-text">
                            <div class="rule-title">30 days</div>
                            <div class="rule-desc">Last click valid for 30 days</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: FAQ -->
        <div class="col-right">
            <!-- FAQ Card -->
            <div class="card">
                <h2 class="title title-sm">‚ùì Frequently Asked Questions</h2>
                
                <div class="faq-item">
                    <div class="faq-question">How am I rewarded?</div>
                    <div class="faq-answer">15% of token creation fees, 10% of liquidity fees. Payment in $BRICK or USDC weekly once your balance reaches $25.</div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">How are referrals tracked?</div>
                    <div class="faq-answer">The ?ref= parameter in your link is stored locally. On first signed transaction, the referral is permanently linked to your wallet.</div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">Can I refer myself?</div>
                    <div class="faq-answer">No, it's automatically detected and blocked. Circular referrals are also excluded.</div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">Do links expire?</div>
                    <div class="faq-answer">Last click is valid for 30 days. If someone clicks then buys 3 weeks later, you still get rewarded.</div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">Where can I see my earnings?</div>
                    <div class="faq-answer">Right here in this dashboard, in real-time once your wallet is connected.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== NOUVEAU : DOUBLE DASHBOARD (Canvas + Plaza) ===== -->
    <div class="dashboard-grid">
        
        <!-- CANVAS DASHBOARD (ROSE) -->
        <div class="dashboard-canvas">
            <h2>üé® Canvas Referrals</h2>
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-label">üí∞ Total earnings</div>
                    <div class="kpi-value canvas-value" id="canvasTotalEarnings">0</div>
                    <div class="kpi-unit">SOL</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">üìä Conversions</div>
                    <div class="kpi-value canvas-value" id="canvasConversions">0</div>
                </div>
            </div>
            <h3 style="color: #FF44AA; margin: 20px 0 12px;">üìã Recent Canvas activity</h3>
            <div class="activity-list" id="canvasActivity">
                <div class="activity-item">
                    <div class="activity-icon canvas-icon">üß±</div>
                    <div class="activity-detail">
                        <span class="canvas-address">Loading...</span>
                    </div>
                    <div class="activity-time"></div>
                </div>
            </div>
        </div>

        <!-- PLAZA DASHBOARD (VERT) -->
        <div class="dashboard-plaza">
            <h2>ü™ô Plaza Referrals</h2>
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-label">üí∞ Total earnings</div>
                    <div class="kpi-value plaza-value" id="plazaTotalEarnings">0</div>
                    <div class="kpi-unit">SOL</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">üìä Conversions</div>
                    <div class="kpi-value plaza-value" id="plazaConversions">0</div>
                </div>
            </div>
            <h3 style="color: #00aa88; margin: 20px 0 12px;">üìã Recent Plaza activity</h3>
            <div class="activity-list" id="plazaActivity">
                <div class="activity-item">
                    <div class="activity-icon plaza-icon">ü™ô</div>
                    <div class="activity-detail">
                        <span class="plaza-address">Loading...</span>
                    </div>
                    <div class="activity-time"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER HARMONIS√â -->
    <footer>
        <div class="footer-links">
            <a href="index.html">üß± Home</a>
            <a href="canvas.html">üé® Canvas</a>
            <a href="plaza.html">ü™ô Plaza</a>
            <a href="eternal-moments.html">‚ú® Eternal</a>
            <a href="how-it-works.html">üìö How it works</a>
            <a href="tokenomics.html">üìä Tokenomics</a>
            <a href="whitepaper.html">üìÑ Whitepaper</a>
            <a href="rules.html">‚öñÔ∏è Rules</a>
            <a href="daily.html">üìÖ Daily</a>
            <a href="referrals.html">ü§ù Referrals</a>
            <a href="https://x.com/BRICK476222" target="_blank">üê¶ BRICK on X</a>
            <a href="https://t.me/brick_fusion_news" target="_blank">üì¢ Telegram News</a>
            <a href="https://t.me/brick_community" target="_blank">üí¨ Telegram Chat</a>
            <a href="mailto:sycomore.crypto+brick@gmail.com">üìß Email BRICK</a>
        </div>
        <div class="footer-copyright">
            üß± BRICK ¬∑ The immortal meme coin ¬∑ Built on Solana ¬∑ 2026
        </div>
    </footer>
</div>

<script>
    // === CONFIGURATION ===
    const SUPABASE_URL = "https://bmfuvkylkhjcfsiauzvb.supabase.co";
    const SUPABASE_ANON = "sb_publishable_VuzUNoj1NnJk1BWSbVzJjQ_WABRhxDh";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

    let currentUser = null;

    // DOM Elements
    const whoamiNav = document.getElementById('whoamiNav');
    const connectPrompt = document.getElementById('connectPrompt');
    const walletInfo = document.getElementById('walletInfo');
    const walletAddress = document.getElementById('walletAddress');
    const referralCard = document.getElementById('referralCard');
    const refLink = document.getElementById('refLink');
    const copyRefBtn = document.getElementById('copyRefBtn');

    // ===== WALLET FUNCTIONS =====
    window.connectWallet = async function() {
        try {
            const provider = window.phantom?.solana || window.solflare;
            if (!provider) {
                alert('Install Phantom or Solflare to continue!');
                window.open('https://phantom.app/', '_blank');
                return;
            }
            const resp = await provider.connect();
            currentUser = provider.publicKey?.toString() || resp.publicKey?.toString();
            
            whoamiNav.textContent = `Connected: ${currentUser.slice(0,4)}...${currentUser.slice(-4)}`;
            whoamiNav.style.color = '#FF44AA';
            
            connectPrompt.style.display = 'none';
            walletInfo.style.display = 'flex';
            walletAddress.textContent = `${currentUser.slice(0,4)}...${currentUser.slice(-4)}`;
            
            const baseUrl = window.location.origin + '/brick';
            refLink.value = `${baseUrl}/?ref=${currentUser}`;
            referralCard.style.display = 'block';
            
            updatePromoLinks();
            await loadAllStats();
            
        } catch (e) {
            alert('Connection error: ' + e.message);
        }
    };

    // ===== UPDATE PROMO LINKS =====
    function updatePromoLinks() {
        if (!currentUser) return;
        const baseUrl = 'https://www.brick-eternal.live/brick';
        const refParam = `?ref=${currentUser}`;
        document.getElementById('link1').href = baseUrl + refParam;
        document.getElementById('link2').href = baseUrl + refParam;
        document.getElementById('link3').href = baseUrl + refParam;
    }

    // ===== COPY REF LINK =====
    window.copyRefLink = function() {
        if (!refLink.value || refLink.value.includes('Connect')) {
            alert('Connect your wallet first!');
            return;
        }
        navigator.clipboard.writeText(refLink.value);
        copyRefBtn.textContent = 'Copied!';
        setTimeout(() => { copyRefBtn.textContent = 'Copy'; }, 2000);
    };

    // ===== LOAD ALL STATS =====
    async function loadAllStats() {
        if (!currentUser) return;

        try {
            // Canvas stats (table bricks)
            const { data: canvasData } = await supabaseClient
                .from('bricks')
                .select('*')
                .eq('referred_by', currentUser);

            // Plaza stats (table plaza_purchases)
            const { data: plazaData } = await supabaseClient
                .from('plaza_purchases')
                .select('*')
                .eq('referred_by', currentUser);

            updateCanvasDashboard(canvasData || []);
            updatePlazaDashboard(plazaData || []);

        } catch (error) {
            console.error('Error loading stats:', error);
        }
    }

    // ===== CANVAS DASHBOARD =====
    function updateCanvasDashboard(referrals) {
        const totalEarnings = referrals.length * 0.1;
        document.getElementById('canvasTotalEarnings').textContent = totalEarnings.toFixed(2);
        document.getElementById('canvasConversions').textContent = referrals.length;

        const activityHtml = referrals.slice(0, 5).map(ref => {
            const timeAgo = ref.created_at ? new Date(ref.created_at).toLocaleString() : 'recently';
            const shortWallet = ref.wallet?.slice(0,4) + '...' + ref.wallet?.slice(-4) || 'Unknown';
            return `
                <div class="activity-item">
                    <div class="activity-icon canvas-icon">üß±</div>
                    <div class="activity-detail">
                        <span class="canvas-address">${shortWallet}</span> bought Canvas brick ${ref.cell}
                    </div>
                    <div class="activity-time">${timeAgo}</div>
                </div>
            `;
        }).join('') || '<div class="activity-item">No activity yet</div>';

        document.getElementById('canvasActivity').innerHTML = activityHtml;
    }

    // ===== PLAZA DASHBOARD =====
    function updatePlazaDashboard(referrals) {
        const totalEarnings = referrals.length * 0.5;
        document.getElementById('plazaTotalEarnings').textContent = totalEarnings.toFixed(2);
        document.getElementById('plazaConversions').textContent = referrals.length;

        const activityHtml = referrals.slice(0, 5).map(ref => {
            const timeAgo = ref.created_at ? new Date(ref.created_at).toLocaleString() : 'recently';
            const shortWallet = ref.wallet?.slice(0,4) + '...' + ref.wallet?.slice(-4) || 'Unknown';
            return `
                <div class="activity-item">
                    <div class="activity-icon plaza-icon">ü™ô</div>
                    <div class="activity-detail">
                        <span class="plaza-address">${shortWallet}</span> bought Plaza spot ${ref.cell}
                    </div>
                    <div class="activity-time">${timeAgo}</div>
                </div>
            `;
        }).join('') || '<div class="activity-item">No activity yet</div>';

        document.getElementById('plazaActivity').innerHTML = activityHtml;
    }

    // ===== DOWNLOAD WITH CODE =====
    window.downloadWithCode = async function(type) {
        if (!currentUser) {
            alert('Connect your wallet first!');
            return;
        }
        
        const btn = document.getElementById(`dl${type.charAt(0).toUpperCase() + type.slice(1)}`);
        const originalText = btn.textContent;
        btn.textContent = '‚è≥ Generating...';
        btn.disabled = true;
        
        try {
            let imgId;
            if (type === 'eternal') imgId = 'promo1-img';
            else if (type === 'canvas') imgId = 'promo2-img';
            else imgId = 'promo3-img';
            
            const imgElement = document.getElementById(imgId);
            const imgSrc = imgElement.src;
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.crossOrigin = 'Anonymous';
            
            await new Promise((resolve, reject) => {
                img.onload = resolve;
                img.onerror = reject;
                img.src = imgSrc;
            });
            
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            
            ctx.font = 'bold 24px "Inter", sans-serif';
            ctx.fillStyle = 'white';
            ctx.shadowColor = 'rgba(0,0,0,0.8)';
            ctx.shadowBlur = 10;
            ctx.textAlign = 'center';
            
            const shortCode = currentUser.slice(0, 6) + '...' + currentUser.slice(-4);
            ctx.fillText(`üîó REF: ${shortCode}`, canvas.width/2, canvas.height - 40);
            ctx.font = 'bold 18px "Inter", sans-serif';
            ctx.fillStyle = 'rgba(255,255,255,0.9)';
            ctx.fillText('üß± BRICK', canvas.width/2, 50);
            
            const link = document.createElement('a');
            link.download = `brick_${type}_${currentUser.slice(0,4)}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            
        } catch (e) {
            let filename;
            if (type === 'eternal') filename = 'etrnalmomentspromo.png';
            else if (type === 'canvas') filename = 'canvascellspromo.png';
            else filename = 'dailyrewardspromo.png';
            window.open(`images/promos/${filename}`, '_blank');
        } finally {
            btn.textContent = originalText;
            btn.disabled = false;
        }
    };

    // ===== CHECK EXISTING SESSION =====
    window.addEventListener('load', async () => {
        const provider = window.phantom?.solana || window.solflare;
        if (provider?.isConnected && provider.publicKey) {
            currentUser = provider.publicKey.toString();
            whoamiNav.textContent = `Connected: ${currentUser.slice(0,4)}...${currentUser.slice(-4)}`;
            whoamiNav.style.color = '#FF44AA';
            connectPrompt.style.display = 'none';
            walletInfo.style.display = 'flex';
            walletAddress.textContent = `${currentUser.slice(0,4)}...${currentUser.slice(-4)}`;
            refLink.value = `${window.location.origin}/brick/?ref=${currentUser}`;
            referralCard.style.display = 'block';
            updatePromoLinks();
            await loadAllStats();
        }
    });
</script>
<!-- ===== CAPTURE UNIVERSELLE DES R√âF√âRENTS ===== -->
<script>
(function() {
    // V√©rifier si un param√®tre ref est pr√©sent dans l'URL
    const urlParams = new URLSearchParams(window.location.search);
    const referrerWallet = urlParams.get('ref');
    
    if (referrerWallet) {
        // Sauvegarder dans localStorage
        localStorage.setItem('brick_referrer', referrerWallet);
        console.log('‚úÖ R√©f√©rent d√©tect√© et sauvegard√©:', referrerWallet.slice(0,4) + '...' + referrerWallet.slice(-4));
        
        // Afficher un message de confirmation discret
        const refMessage = document.createElement('div');
        refMessage.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #FF44AA;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            z-index: 9999;
            box-shadow: 0 4px 20px rgba(255,68,170,0.4);
            border: 1px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(5px);
            animation: slideIn 0.3s ease-out;
        `;
        refMessage.innerHTML = `
            <div style="display: flex; align-items: center; gap: 8px;">
                <span>üß±</span>
                <span>‚ú® Referred by <strong>${referrerWallet.slice(0,4)}...${referrerWallet.slice(-4)}</strong></span>
            </div>
        `;
        
        // Ajouter l'animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
        
        document.body.appendChild(refMessage);
        
        // Faire dispara√Ætre apr√®s 5 secondes
        setTimeout(() => {
            refMessage.style.animation = 'slideOut 0.3s ease-out forwards';
            setTimeout(() => refMessage.remove(), 300);
        }, 5000);
        
        // Ajouter l'animation de sortie
        const styleOut = document.createElement('style');
        styleOut.textContent = `
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(styleOut);
    }
})();
</script>
<!-- ===== FIN CAPTURE R√âF√âRENTS ===== -->
</body>
</html>
